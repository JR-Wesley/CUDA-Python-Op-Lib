cmake_minimum_required(VERSION 3.18)
project(cuda_vec_add LANGUAGES CXX CUDA)

# è®¾ç½®æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CUDA_STANDARD 17)

# # ğŸ”§ è®¾ç½® LibTorch è·¯å¾„ï¼ˆä¿®æ”¹ä¸ºä½ è‡ªå·±çš„è·¯å¾„ï¼‰
# set(LIBTORCH ${CMAKE_CURRENT_SOURCE_DIR}/../libtorch)
# list(APPEND CMAKE_PREFIX_PATH "${LIBTORCH}")
find_package(Torch REQUIRED)

file(GLOB BIND_SOURCES "binding/binding.cpp")
file(GLOB KERNEL_SOURCES "kernel/*.cu")

set(ALL_SOURCES
    ${BIND_SOURCES}
    ${KERNEL_SOURCES}
    test/test_vec_add_torch.cpp  # ä¸»æ–‡ä»¶ä¹ŸåŒ…å«è¿›æ¥
)

set(TARGET_NAME "vec_add_test")

add_executable(${TARGET_NAME} ${ALL_SOURCES})

target_link_libraries(${TARGET_NAME} "${TORCH_LIBRARIES}")

# ç¼–è¯‘é€‰é¡¹
target_compile_options(${TARGET_NAME} PRIVATE
    $<$<COMPILE_LANGUAGE:CUDA>:-O3 --use_fast_math -arch=sm_89>
    $<$<COMPILE_LANGUAGE:CXX>:-O3>
)

#  è¾“å‡ºä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
message(STATUS "Target: ${TARGET_NAME}")
message(STATUS "Sources: ${ALL_SOURCES}")
